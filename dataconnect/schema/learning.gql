type LearningPlan @table {
  id: ID! @id @default(expr: "uuid_generate_v4()")
  userId: ID! @foreignKey(references: "User.id") @unique
  planData: JSON!
  generatedBy: String!
  generatedAt: Timestamp!
  createdAt: Timestamp! @default(expr: "now()")
  updatedAt: Timestamp! @default(expr: "now()")

  # Relaciones
  user: User! @belongsTo
  sections: [PlanSection!]! @hasMany
}

type PlanSection @table {
  id: ID! @id @default(expr: "uuid_generate_v4()")
  planId: ID! @foreignKey(references: "LearningPlan.id")
  title: String!
  description: String
  order: Int!
  createdAt: Timestamp! @default(expr: "now()")
  updatedAt: Timestamp! @default(expr: "now()")

  # Relaciones
  plan: LearningPlan! @belongsTo
  days: [DayContent!]! @hasMany
}

type DayContent @table {
  id: ID! @id @default(expr: "uuid_generate_v4()")
  sectionId: ID! @foreignKey(references: "PlanSection.id")
  dayNumber: Int!
  title: String!
  isActionDay: Boolean!
  content: JSON!
  generatedBy: String!
  generatedAt: Timestamp!
  completionStatus: String! @default(value: "pending")
  completedAt: Timestamp
  createdAt: Timestamp! @default(expr: "now()")
  updatedAt: Timestamp! @default(expr: "now()")

  # Relaciones
  section: PlanSection! @belongsTo
  progress: [ContentProgress!]! @hasMany

  # Índices
  @@index([sectionId, dayNumber])
  @@unique([sectionId, dayNumber])
}

type ContentProgress @table {
  id: ID! @id @default(expr: "uuid_generate_v4()")
  dayContentId: ID! @foreignKey(references: "DayContent.id")
  userId: ID! @foreignKey(references: "User.id")
  blockType: ContentBlockType!
  blockId: String!
  completed: Boolean! @default(value: false)
  xpEarned: Int! @default(value: 0)
  attempts: Int! @default(value: 0)
  completedAt: Timestamp
  createdAt: Timestamp! @default(expr: "now()")
  updatedAt: Timestamp! @default(expr: "now()")

  # Relaciones
  dayContent: DayContent! @belongsTo
  user: User! @belongsTo

  # Índices
  @@index([userId, completed])
  @@unique([dayContentId, userId, blockId])
} 